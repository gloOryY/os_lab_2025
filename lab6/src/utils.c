/*
 * utils.c - Реализация общих утилит для клиента и сервера
 */

#include "utils.h"

/*
 * Реализация безопасного умножения по модулю
 * 
 * Пример работы для a=5, b=7, mod=13:
 *   b=7 (двоичное: 111)
 *   Итерация 1: b%2=1, result=(0+5)%13=5,  a=(5*2)%13=10, b=3
 *   Итерация 2: b%2=1, result=(5+10)%13=2, a=(10*2)%13=7, b=1
 *   Итерация 3: b%2=1, result=(2+7)%13=9,  a=(7*2)%13=1,  b=0
 *   Результат: 9 (что равно (5*7)%13 = 35%13 = 9)
 */
uint64_t MultModulo(uint64_t a, uint64_t b, uint64_t mod) {
    uint64_t result = 0;
    a = a % mod;  // Приводим a по модулю для начальной оптимизации
    
    // Цикл продолжается, пока b > 0
    while (b > 0) {
        // Если младший бит b равен 1, добавляем текущее значение a к результату
        if (b % 2 == 1)
            result = (result + a) % mod;
        
        // Удваиваем a (сдвиг влево в двоичном представлении)
        a = (a * 2) % mod;
        
        // Делим b пополам (сдвиг вправо в двоичном представлении)
        b /= 2;
    }
    
    return result % mod;
}
